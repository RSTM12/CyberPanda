<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CyberPanda Kombat</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- TON CONNECT SDK -->
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Rajdhani', 'sans-serif'] },
                    colors: {
                        cyber: { blue: '#00f3ff', purple: '#bd00ff', gold: '#ffd700', dark: '#0a0a12' }
                    },
                    animation: {
                        'spin-slow': 'spin 15s linear infinite',
                        'pulse-glow': 'pulseGlow 2s ease-in-out infinite',
                    },
                    keyframes: {
                        pulseGlow: {
                            '0%, 100%': { boxShadow: '0 0 20px rgba(0, 243, 255, 0.3)' },
                            '50%': { boxShadow: '0 0 40px rgba(189, 0, 255, 0.6)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #020205;
            background-image: 
                radial-gradient(circle at 50% 0%, rgba(189, 0, 255, 0.2) 0%, transparent 50%),
                linear-gradient(rgba(0, 243, 255, 0.05) 1px, transparent 1px);
            background-size: 100% 100%, 30px 30px;
            color: white; overflow: hidden; user-select: none; touch-action: manipulation;
        }

        .glass-card {
            background: rgba(20, 20, 35, 0.6); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }
        .glass-card:active { background: rgba(40, 40, 60, 0.8); border-color: rgba(0, 243, 255, 0.3); }

        .nav-glass {
            background: rgba(10, 10, 18, 0.95); backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .floating-text {
            position: absolute; color: #00f3ff; font-weight: 700; font-size: 32px;
            animation: floatUp 0.8s ease-out forwards; pointer-events: none; z-index: 100;
        }
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-100px) scale(1.5); }
        }

        .tab-content { display: none; height: 100%; }
        .tab-content.active { display: flex; flex-direction: column; }
        
        #welcome-screen { transition: opacity 0.5s ease-out, visibility 0.5s; }
        .hidden-screen { opacity: 0; visibility: hidden; pointer-events: none; }
        
        #ton-connect-btn button { width: 100%; justify-content: center; font-family: 'Rajdhani', sans-serif; font-weight: bold; }
    </style>
</head>
<body class="h-screen flex flex-col font-sans">

    <!-- WELCOME SCREEN -->
    <div id="welcome-screen" class="fixed inset-0 z-[999] bg-[#020205] flex flex-col items-center justify-center p-6 text-center">
        <div class="absolute inset-0 bg-[linear-gradient(rgba(0,243,255,0.03)_1px,transparent_1px)] bg-[length:40px_40px] pointer-events-none"></div>
        <div class="relative z-10 flex flex-col items-center">
            <!-- PANDA LOGO -->
            <div class="w-32 h-32 mb-6 rounded-full bg-gradient-to-b from-cyber-blue to-cyber-purple p-1 animate-pulse-glow">
                <div class="w-full h-full bg-black rounded-full flex items-center justify-center overflow-hidden">
                    <img src="https://cdn-icons-png.flaticon.com/512/3305/3305755.png" alt="Panda" class="w-24 h-24 filter brightness-125">
                </div>
            </div>
            
            <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyber-blue to-purple-500 mb-2">CYBER PANDA</h1>
            <p class="text-gray-400 tracking-[0.3em] text-sm mb-12">SYSTEM PROTOCOL V.6.0</p>
            <div class="glass-card p-6 rounded-2xl w-full max-w-xs border border-cyber-blue/20 mb-8">
                <p class="text-gray-400 text-sm mb-1">Welcome Agent,</p>
                <h2 id="welcome-name" class="text-2xl font-bold text-cyber-gold tracking-wide">Unknown User</h2>
            </div>
            <button onclick="startGame()" class="px-10 py-4 bg-cyber-dark border border-cyber-blue text-cyber-blue font-bold tracking-widest uppercase hover:bg-cyber-blue hover:text-black transition-all">INITIALIZE SYSTEM</button>
        </div>
    </div>

    <!-- HEADER -->
    <div class="fixed top-0 left-0 right-0 p-4 z-20">
        <div class="glass-card rounded-2xl p-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-cyber-purple to-cyber-blue p-[2px]">
                    <div class="w-full h-full bg-cyber-dark rounded-xl flex items-center justify-center">
                         <img src="https://cdn-icons-png.flaticon.com/512/4616/4616389.png" class="w-6 h-6 invert" alt="user">
                    </div>
                </div>
                <div class="flex flex-col">
                    <span id="username" class="font-bold tracking-wider text-sm">Agent</span>
                    <div class="flex items-center gap-1">
                        <div id="wallet-indicator" class="w-2 h-2 rounded-full bg-gray-500"></div>
                        <span id="wallet-status-text" class="text-[10px] text-gray-400 uppercase">No Wallet</span>
                    </div>
                </div>
            </div>
            <div class="flex flex-col items-end">
                <span class="text-[10px] text-cyber-blue uppercase tracking-widest">Profit/Sec</span>
                <div class="flex items-center gap-1">
                    <i class="fa-solid fa-bolt text-cyber-gold text-sm animate-pulse"></i>
                    <span id="profit-per-sec" class="font-bold text-lg text-cyber-blue">+0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="flex-1 overflow-hidden relative w-full max-w-md mx-auto pt-24 pb-24">
        
        <!-- HOME TAB -->
        <div id="tab-home" class="tab-content active items-center justify-center relative h-full">
            <div class="mb-8 text-center relative z-10">
                <h1 class="text-5xl font-bold flex items-center justify-center gap-3 text-neon-gold" style="text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);">
                    <img src="https://cdn-icons-png.flaticon.com/512/7902/7902274.png" alt="coin" class="w-12 h-12">
                    <span id="balance">0</span>
                </h1>
                <p class="text-cyber-blue text-sm tracking-[0.3em] mt-2 uppercase opacity-70">Neural Credits</p>
            </div>

            <!-- TOMBOL UTAMA (TOKEN EMAS) -->
            <div id="click-btn" class="relative w-80 h-80 group cursor-pointer z-10">
                <div class="absolute inset-0 rounded-full border-[4px] border-cyber-blue/20 border-dashed animate-spin-slow"></div>
                <div class="absolute inset-4 rounded-full bg-gradient-to-tr from-cyber-purple/40 via-cyber-dark to-cyber-blue/40 backdrop-blur-md border border-white/10 shadow-[0_0_80px_rgba(0,243,255,0.3)] animate-pulse-glow group-active:scale-95 transition-all duration-150"></div>
                <div class="absolute inset-0 flex items-center justify-center group-active:scale-90 transition-transform duration-150">
                    
                    <!-- INI GAMBAR TOKEN EMAS -->
                    <img src="https://storage.googleapis.com/gweb-uniblog-publish-prod/original_images/image2_h428_w428_gif.gif" alt="Golden CyberPanda Token" class="w-64 h-64 drop-shadow-[0_0_40px_rgba(0,243,255,0.5)] relative z-20 rounded-full object-cover">
                
                </div>
            </div>

            <div class="w-full px-8 absolute bottom-4">
                <div class="flex justify-between text-xs text-cyber-blue mb-2 font-bold uppercase"><span>Energy</span><span id="energy-display">1000 / 1000</span></div>
                <div class="w-full bg-cyber-dark/50 h-4 overflow-hidden border border-cyber-blue/30 skew-x-[-10deg]">
                    <div id="energy-bar" class="bg-gradient-to-r from-cyber-blue via-cyber-purple to-cyber-blue h-full" style="width: 100%"></div>
                </div>
            </div>
        </div>

        <!-- BOOST TAB -->
        <div id="tab-mine" class="tab-content px-4">
            <h2 class="text-2xl font-bold mb-6 text-cyber-blue uppercase border-b border-cyber-blue/20 pb-2">Upgrades</h2>
            <div class="space-y-4">
                <div onclick="buyUpgrade('multitap')" class="glass-card p-4 rounded-2xl flex items-center justify-between cursor-pointer group">
                    <div class="flex items-center gap-4"><div class="w-12 h-12 bg-cyber-dark rounded-xl flex items-center justify-center text-2xl border border-cyber-blue/30">üëÜ</div><div><h3 class="font-bold">Neural Tap</h3><p class="text-xs text-gray-400">+1 Power</p></div></div>
                    <div class="text-cyber-gold font-bold"><i class="fa-solid fa-coins"></i> <span id="price-multitap">500</span></div>
                </div>
                <div onclick="buyUpgrade('energy')" class="glass-card p-4 rounded-2xl flex items-center justify-between cursor-pointer group">
                    <div class="flex items-center gap-4"><div class="w-12 h-12 bg-cyber-dark rounded-xl flex items-center justify-center text-2xl border border-green-500/30">üîã</div><div><h3 class="font-bold">Battery Core</h3><p class="text-xs text-gray-400">+500 Max</p></div></div>
                    <div class="text-cyber-gold font-bold"><i class="fa-solid fa-coins"></i> <span id="price-energy">1000</span></div>
                </div>
                 <div onclick="buyUpgrade('mining_rig')" class="glass-card p-4 rounded-2xl flex items-center justify-between cursor-pointer group border border-cyber-gold/30">
                    <div class="flex items-center gap-4"><div class="w-12 h-12 bg-cyber-dark rounded-xl flex items-center justify-center text-2xl border border-cyber-gold/30">‚öôÔ∏è</div><div><h3 class="font-bold text-cyber-gold">Quantum Rig</h3><p class="text-xs text-gray-400">Auto 50/sec</p></div></div>
                    <div class="text-cyber-gold font-bold"><i class="fa-solid fa-coins"></i> <span id="price-mining_rig">5000</span></div>
                </div>
            </div>
        </div>

        <!-- EARN TAB -->
        <div id="tab-earn" class="tab-content px-4">
            <h2 class="text-2xl font-bold mb-6 text-cyber-blue uppercase border-b border-cyber-blue/20 pb-2">Airdrop Tasks</h2>
            <div class="space-y-6 pb-4">
                <div class="glass-card p-5 rounded-2xl border border-cyber-blue/50 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-20 h-20 bg-cyber-blue/20 blur-2xl rounded-full"></div>
                    <div class="flex items-center gap-4 mb-4 relative z-10">
                        <img src="https://ton.org/download/ton_symbol.png" class="w-12 h-12 drop-shadow-lg">
                        <div><h3 class="font-bold text-lg text-white">Connect TON Wallet</h3><p class="text-xs text-gray-400">Link wallet to receive future airdrops.</p></div>
                    </div>
                    <div id="ton-connect-btn" class="w-full relative z-10"></div>
                </div>
                <h3 class="text-sm font-bold text-gray-500 uppercase tracking-widest mt-4">Social Missions</h3>
                <div id="task-list" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <!-- NAV BAR & TOAST -->
    <div class="fixed bottom-6 left-6 right-6 z-50">
        <div class="nav-glass rounded-full p-2 flex justify-around items-center shadow-[0_10px_30px_rgba(0,0,0,0.5)]">
            <button onclick="switchTab('home')" class="nav-btn text-cyber-blue flex flex-col items-center w-1/3" data-target="home"><i class="fa-solid fa-microchip text-xl mb-1"></i><span class="text-[10px] font-bold">CORE</span></button>
            <button onclick="switchTab('mine')" class="nav-btn text-gray-500 flex flex-col items-center w-1/3" data-target="mine"><i class="fa-solid fa-rocket text-xl mb-1"></i><span class="text-[10px] font-bold">BOOST</span></button>
            <button onclick="switchTab('earn')" class="nav-btn text-gray-500 flex flex-col items-center w-1/3" data-target="earn"><i class="fa-solid fa-satellite-dish text-xl mb-1"></i><span class="text-[10px] font-bold">EARN</span></button>
        </div>
    </div>
    <div id="toast" class="fixed top-24 left-1/2 transform -translate-x-1/2 glass-card px-6 py-3 rounded-full border-cyber-blue/50 opacity-0 pointer-events-none z-[100] flex items-center gap-3 transition-all duration-300"><i class="fa-solid fa-circle-check text-cyber-blue"></i><span id="toast-msg" class="text-sm font-bold">Success</span></div>

    <script>
        const tg = window.Telegram.WebApp; tg.ready(); tg.expand();
        if (tg.setHeaderColor) tg.setHeaderColor('#020205');

        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: './tonconnect-manifest.json',
            buttonRootId: 'ton-connect-btn'
        });

        // Simpan Data di LocalStorage V6
        const defaultData = { hasStarted: false, balance: 0, energy: 1000, maxEnergy: 1000, clickPower: 1, profitPerSec: 1, lastLogin: Date.now(), upgrades: { multitap: { level: 1, price: 500 }, energy: { level: 1, price: 1000 }, mining_rig: { level: 0, price: 5000 } }, completedTasks: [] };
        let gameData = JSON.parse(localStorage.getItem('cyberPandaData_v6')) || defaultData;
        
        const welcomeScreen = document.getElementById('welcome-screen');
        const userName = tg.initDataUnsafe?.user?.first_name || "Agent";
        document.getElementById('welcome-name').innerText = userName;
        document.getElementById('username').innerText = userName;

        if (gameData.hasStarted) { welcomeScreen.style.display = 'none'; }

        window.startGame = () => {
            welcomeScreen.classList.add('hidden-screen');
            gameData.hasStarted = true;
            localStorage.setItem('cyberPandaData_v6', JSON.stringify(gameData));
            if(tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            setTimeout(() => welcomeScreen.style.display = 'none', 600);
        };

        const walletIndicator = document.getElementById('wallet-indicator');
        const walletStatusText = document.getElementById('wallet-status-text');

        tonConnectUI.onStatusChange(wallet => {
            if (wallet) {
                walletIndicator.classList.remove('bg-gray-500'); walletIndicator.classList.add('bg-green-500', 'shadow-[0_0_10px_#00ff00]');
                const addr = wallet.account.address; walletStatusText.innerText = addr.slice(0,4) + '...' + addr.slice(-4); walletStatusText.classList.add('text-green-400');
            } else {
                walletIndicator.classList.add('bg-gray-500'); walletIndicator.classList.remove('bg-green-500', 'shadow-[0_0_10px_#00ff00]');
                walletStatusText.innerText = "No Wallet"; walletStatusText.classList.remove('text-green-400');
            }
        });

        const now = Date.now();
        if (gameData.hasStarted && (now - gameData.lastLogin) > 0) gameData.balance += Math.floor((now - gameData.lastLogin)/1000) * gameData.profitPerSec;
        gameData.lastLogin = now;

        const balanceEl = document.getElementById('balance'); const energyDisplay = document.getElementById('energy-display'); const energyBar = document.getElementById('energy-bar'); const profitEl = document.getElementById('profit-per-sec');
        function updateUI() {
            balanceEl.innerText = Math.floor(gameData.balance).toLocaleString(); energyDisplay.innerText = `${Math.floor(gameData.energy)} / ${gameData.maxEnergy}`; energyBar.style.width = `${(gameData.energy / gameData.maxEnergy) * 100}%`; profitEl.innerText = `+${gameData.profitPerSec}`;
            document.getElementById('price-multitap').innerText = gameData.upgrades.multitap.price.toLocaleString();
            document.getElementById('price-energy').innerText = gameData.upgrades.energy.price.toLocaleString();
            const rig = gameData.upgrades.mining_rig;
            document.getElementById('price-mining_rig').parentNode.parentNode.innerHTML = rig.level > 0 ? '<span class="text-cyber-blue font-bold">ACTIVE</span>' : `<div class="text-cyber-gold font-bold"><i class="fa-solid fa-coins"></i> <span id="price-mining_rig">${rig.price}</span></div>`;
        }

        setInterval(() => {
            if (gameData.hasStarted) {
                gameData.balance += gameData.profitPerSec;
                if (gameData.energy < gameData.maxEnergy) gameData.energy += 2;
                if (gameData.energy > gameData.maxEnergy) gameData.energy = gameData.maxEnergy;
                gameData.lastLogin = Date.now();
                localStorage.setItem('cyberPandaData_v6', JSON.stringify(gameData));
                updateUI();
            }
        }, 1000);

        document.getElementById('click-btn').addEventListener('pointerdown', (e) => {
            if (gameData.energy >= gameData.clickPower) {
                gameData.balance += gameData.clickPower; gameData.energy -= gameData.clickPower;
                if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('heavy');
                updateUI();
                const el = document.createElement('div'); el.className = 'floating-text'; el.innerText = `+${gameData.clickPower}`;
                el.style.left = `${e.clientX}px`; el.style.top = `${e.clientY - 80}px`;
                document.body.appendChild(el); setTimeout(() => el.remove(), 800);
            } else if(tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
        });

        window.buyUpgrade = (type) => {
            const up = gameData.upgrades[type];
            if (type === 'mining_rig' && up.level > 0) return showToast('Already Active!', 'error');
            if (gameData.balance >= up.price) {
                gameData.balance -= up.price;
                if (type === 'mining_rig') { up.level = 1; gameData.profitPerSec = 50; showToast('Rig Activated!');}
                else { up.level++; up.price = Math.floor(up.price * 1.6); if(type=='multitap') gameData.clickPower++; if(type=='energy') gameData.maxEnergy+=500; showToast('Upgraded!');}
                updateUI();
            } else showToast('Need Credits!', 'error');
        };

        // --- UPDATE DAFTAR TUGAS DI SINI ---
        const tasks = [
            // Tugas Baru: Official Channel (Reward 5000)
            { id: 'tg_channel_ofc', title: 'Join Official Channel', reward: 5000, icon: 'fa-telegram', url: 'https://t.me/CyberpandaOFC' },
            // Tugas Twitter SUDAH DIHAPUS
            // Tugas YouTube Tetap Ada
            { id: 'youtube', title: 'Subscribe YouTube', reward: 2000, icon: 'fa-youtube', url: 'https://youtube.com' }
        ];

        function renderTasks() {
            const list = document.getElementById('task-list'); list.innerHTML = '';
            tasks.forEach(task => {
                const isDone = gameData.completedTasks.includes(task.id);
                const item = document.createElement('div');
                item.className = `glass-card p-4 rounded-2xl flex items-center justify-between ${isDone ? 'opacity-50' : 'cursor-pointer'}`;
                if(!isDone) item.onclick = () => {
                    tg.openLink(task.url); showToast("Verifying...", "info");
                    setTimeout(() => { gameData.balance += task.reward; gameData.completedTasks.push(task.id); renderTasks(); updateUI(); showToast("Credits Added!"); }, 3000);
                };
                item.innerHTML = `<div class="flex items-center gap-3"><i class="fa-brands ${task.icon} text-2xl text-cyber-blue"></i><div><h3 class="font-bold text-sm">${task.title}</h3><div class="text-cyber-gold text-xs font-bold">+${task.reward}</div></div></div>${isDone ? '<i class="fa-solid fa-check text-cyber-blue"></i>' : '<div class="bg-cyber-blue/20 text-cyber-blue px-3 py-1 rounded text-[10px] font-bold">GO</div>'}`;
                list.appendChild(item);
            });
        }

        window.switchTab = (tabId) => {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('text-cyber-blue'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
            document.querySelector(`.nav-btn[data-target="${tabId}"]`).classList.add('text-cyber-blue');
            if(tabId === 'earn') renderTasks();
        };

        function showToast(msg, type='success') {
            const t = document.getElementById('toast'); document.getElementById('toast-msg').innerText = msg;
            t.style.opacity = '1'; t.style.transform = 'translate(-50%, 0)';
            setTimeout(() => { t.style.opacity = '0'; t.style.transform = 'translate(-50%, -20px)'; }, 2000);
        }

        updateUI(); renderTasks();
    </script>
</body>
</html>
