<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CyberPanda Kombat</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Rajdhani', 'sans-serif'] },
                    colors: {
                        cyber: { blue: '#00f3ff', purple: '#bd00ff', gold: '#ffd700', dark: '#0a0a12' }
                    },
                    animation: {
                        'spin-slow': 'spin 15s linear infinite',
                        'pulse-glow': 'pulseGlow 2s ease-in-out infinite',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #020205;
            background-image: radial-gradient(circle at 50% 0%, #bd00ff33 0%, transparent 50%);
            color: white; overflow: hidden; user-select: none; touch-action: manipulation;
        }
        .glass-card {
            background: rgba(20, 20, 35, 0.6); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .nav-glass {
            background: rgba(10, 10, 18, 0.95); backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        .tab-content { display: none; height: 100%; }
        .tab-content.active { display: flex; flex-direction: column; }
        .hidden-screen { opacity: 0; visibility: hidden; pointer-events: none; transition: 0.5s; }
        .floating-text { position: absolute; color: #00f3ff; font-weight: bold; font-size: 28px; animation: floatUp 0.8s forwards; pointer-events: none; z-index: 50; }
        @keyframes floatUp { to { opacity: 0; transform: translateY(-80px); } }
        
        #ton-connect-btn { width: 100%; }
        #ton-connect-btn button { width: 100%; justify-content: center; font-family: 'Rajdhani', sans-serif; font-weight: bold; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="h-screen flex flex-col font-sans">

    <!-- WELCOME SCREEN -->
    <div id="welcome-screen" class="fixed inset-0 z-[999] bg-[#020205] flex flex-col items-center justify-center p-6 text-center transition-all duration-500">
        <div class="relative z-10 flex flex-col items-center">
            <div class="w-32 h-32 mb-6 rounded-full bg-gradient-to-b from-cyber-blue to-cyber-purple p-1 animate-pulse-glow">
                <div class="w-full h-full bg-black rounded-full flex items-center justify-center overflow-hidden">
                    <svg viewBox="0 0 200 200" class="w-24 h-24">
                        <circle cx="100" cy="100" r="90" fill="#fff"/>
                        <circle cx="60" cy="70" r="25" fill="#000"/>
                        <circle cx="140" cy="70" r="25" fill="#000"/>
                        <ellipse cx="100" cy="110" rx="15" ry="10" fill="#000"/>
                        <path d="M 80 130 Q 100 150 120 130" stroke="#000" stroke-width="5" fill="none"/>
                        <circle cx="30" cy="50" r="20" fill="#000"/>
                        <circle cx="170" cy="50" r="20" fill="#000"/>
                    </svg>
                </div>
            </div>
            
            <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyber-blue to-purple-500 mb-2">CYBER PANDA</h1>
            <p class="text-gray-400 tracking-[0.3em] text-sm mb-12">OFFICIAL SYSTEM</p>
            <div class="glass-card p-6 rounded-2xl w-full max-w-xs border border-cyber-blue/20 mb-8">
                <p class="text-gray-400 text-sm mb-1">Welcome Agent,</p>
                <h2 id="welcome-name" class="text-2xl font-bold text-cyber-gold tracking-wide">Unknown User</h2>
            </div>
            <button onclick="startGame()" class="px-10 py-4 bg-cyber-dark border border-cyber-blue text-cyber-blue font-bold tracking-widest uppercase hover:bg-cyber-blue hover:text-black transition-all">INITIALIZE SYSTEM</button>
        </div>
    </div>

    <!-- HEADER -->
    <div class="fixed top-0 left-0 right-0 p-4 z-20">
        <div class="glass-card rounded-2xl p-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-cyber-purple to-cyber-blue p-[2px]">
                    <div class="w-full h-full bg-cyber-dark rounded-xl flex items-center justify-center font-bold text-xl">üêº</div>
                </div>
                <div class="flex flex-col">
                    <span id="username" class="font-bold tracking-wider text-sm">Agent</span>
                    <!-- STATUS WALLET DI HEADER -->
                    <div class="flex items-center gap-1">
                        <div id="wallet-indicator" class="w-2 h-2 rounded-full bg-gray-500 transition-all"></div>
                        <span id="wallet-status-text" class="text-[10px] text-gray-400 uppercase font-mono">No Wallet</span>
                    </div>
                </div>
            </div>
            <div class="flex flex-col items-end">
                <span class="text-[10px] text-cyber-blue uppercase tracking-widest">Profit/Sec</span>
                <div class="flex items-center gap-1">
                    <i class="fa-solid fa-bolt text-cyber-gold text-sm"></i>
                    <span id="profit-per-sec" class="font-bold text-lg text-cyber-blue">+0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="flex-1 overflow-hidden relative w-full max-w-md mx-auto pt-24 pb-24">
        
        <!-- HOME TAB -->
        <div id="tab-home" class="tab-content active items-center justify-center relative h-full">
            <div class="mb-8 text-center relative z-10">
                <h1 class="text-5xl font-bold flex items-center justify-center gap-3 text-cyber-gold" style="text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);">
                    <div class="w-10 h-10 rounded-full bg-yellow-500 flex items-center justify-center text-black font-bold">$</div>
                    <span id="balance">0</span>
                </h1>
                <p class="text-cyber-blue text-sm tracking-[0.3em] mt-2 uppercase opacity-70">Neural Credits</p>
            </div>

            <!-- KOIN PANDA SVG -->
            <div id="click-btn" class="relative w-72 h-72 cursor-pointer z-10 flex items-center justify-center active:scale-95 transition-transform">
                <div class="absolute inset-0 rounded-full border-[4px] border-cyber-blue/20 border-dashed animate-spin-slow"></div>
                <svg viewBox="0 0 200 200" class="w-64 h-64 drop-shadow-[0_0_30px_rgba(255,215,0,0.4)]">
                    <defs>
                        <linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#B8860B;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#FFD700;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <circle cx="100" cy="100" r="95" fill="url(#goldGrad)" stroke="#B8860B" stroke-width="2"/>
                    <circle cx="100" cy="100" r="85" fill="#1a1a1a" stroke="#B8860B" stroke-width="1"/>
                    <g transform="translate(25, 25) scale(0.75)">
                         <circle cx="30" cy="40" r="25" fill="#333"/>
                         <circle cx="170" cy="40" r="25" fill="#333"/>
                         <circle cx="100" cy="100" r="80" fill="#fff"/>
                         <ellipse cx="65" cy="85" rx="25" ry="30" fill="#000"/>
                         <ellipse cx="135" cy="85" rx="25" ry="30" fill="#000"/>
                         <circle cx="65" cy="80" r="8" fill="#fff"/>
                         <circle cx="135" cy="80" r="8" fill="#fff"/>
                         <ellipse cx="100" cy="120" rx="15" ry="10" fill="#000"/>
                         <path d="M 85 145 Q 100 155 115 145" stroke="#000" stroke-width="5" fill="none"/>
                    </g>
                </svg>
            </div>

            <div class="w-full px-8 absolute bottom-4">
                <div class="flex justify-between text-xs text-cyber-blue mb-2 font-bold uppercase"><span>Energy</span><span id="energy-display">1000 / 1000</span></div>
                <div class="w-full bg-cyber-dark/50 h-4 overflow-hidden border border-cyber-blue/30 skew-x-[-10deg]">
                    <div id="energy-bar" class="bg-gradient-to-r from-cyber-blue via-cyber-purple to-cyber-blue h-full" style="width: 100%"></div>
                </div>
            </div>
        </div>

        <!-- BOOST TAB -->
        <div id="tab-mine" class="tab-content px-4">
            <h2 class="text-2xl font-bold mb-6 text-cyber-blue uppercase border-b border-cyber-blue/20 pb-2">Upgrades</h2>
            <div class="space-y-4">
                <div onclick="buyUpgrade('multitap')" class="glass-card p-4 rounded-2xl flex items-center justify-between cursor-pointer">
                    <div class="flex items-center gap-4"><div class="w-12 h-12 bg-cyber-dark rounded-xl flex items-center justify-center text-2xl border border-cyber-blue/30">üëÜ</div><div><h3 class="font-bold">Neural Tap</h3><p class="text-xs text-gray-400">+1 Power</p></div></div>
                    <div class="text-cyber-gold font-bold"><i class="fa-solid fa-coins"></i> <span id="price-multitap">500</span></div>
                </div>
                <div onclick="buyUpgrade('energy')" class="glass-card p-4 rounded-2xl flex items-center justify-between cursor-pointer">
                    <div class="flex items-center gap-4"><div class="w-12 h-12 bg-cyber-dark rounded-xl flex items-center justify-center text-2xl border border-green-500/30">üîã</div><div><h3 class="font-bold">Battery Core</h3><p class="text-xs text-gray-400">+500 Max</p></div></div>
                    <div class="text-cyber-gold font-bold"><i class="fa-solid fa-coins"></i> <span id="price-energy">1000</span></div>
                </div>
                 <div onclick="buyUpgrade('mining_rig')" class="glass-card p-4 rounded-2xl flex items-center justify-between cursor-pointer border border-cyber-gold/30">
                    <div class="flex items-center gap-4"><div class="w-12 h-12 bg-cyber-dark rounded-xl flex items-center justify-center text-2xl border border-cyber-gold/30">‚öôÔ∏è</div><div><h3 class="font-bold text-cyber-gold">Quantum Rig</h3><p class="text-xs text-gray-400">Auto 50/sec</p></div></div>
                    <div class="text-cyber-gold font-bold"><i class="fa-solid fa-coins"></i> <span id="price-mining_rig">5000</span></div>
                </div>
            </div>
        </div>

        <!-- EARN TAB -->
        <div id="tab-earn" class="tab-content px-4">
            <h2 class="text-2xl font-bold mb-4 text-cyber-blue uppercase border-b border-cyber-blue/20 pb-2">Daily Rewards</h2>
            
            <div class="glass-card p-4 rounded-2xl mb-6 relative z-10">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-white">Login Streak</h3>
                    <span id="daily-streak-display" class="text-cyber-gold font-bold">Day 1</span>
                </div>
                <div class="flex gap-3 overflow-x-auto no-scrollbar pb-2" id="daily-container"></div>
                <button id="daily-claim-btn" class="w-full mt-2 py-2 bg-cyber-blue/20 border border-cyber-blue text-cyber-blue font-bold rounded-xl hover:bg-cyber-blue hover:text-black transition-all disabled:opacity-50 disabled:cursor-not-allowed z-20 relative">
                    CLAIM REWARD
                </button>
            </div>

            <h2 class="text-xl font-bold mb-4 text-cyber-blue uppercase border-b border-cyber-blue/20 pb-2">Airdrop Tasks</h2>
            <div class="space-y-4 pb-4">
                <div class="glass-card p-5 rounded-2xl border border-cyber-blue/50 relative z-30">
                    <div class="flex items-center gap-4 mb-4">
                        <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-2xl font-bold">üíé</div>
                        <div><h3 class="font-bold text-lg text-white">Connect TON Wallet</h3><p class="text-xs text-gray-400">Link wallet for airdrops.</p></div>
                    </div>
                    <!-- WADAH TOMBOL TON DI SINI -->
                    <div id="ton-connect-btn"></div>
                </div>
                <div id="task-list" class="space-y-4"></div>
            </div>
        </div>

        <!-- LEADERBOARD TAB (FIXED) -->
        <div id="tab-rank" class="tab-content px-4">
            <h2 class="text-2xl font-bold mb-6 text-cyber-blue uppercase border-b border-cyber-blue/20 pb-2 flex justify-between">
                <span>Leaderboard</span>
                <span class="text-xs text-gray-400 mt-2 font-normal lowercase">global ranking</span>
            </h2>
            
            <!-- KARTU SAYA (USER) -->
            <div class="glass-card p-4 rounded-2xl mb-6 border border-cyber-gold/50 flex items-center justify-between bg-cyber-gold/10">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-cyber-gold flex items-center justify-center text-black font-bold text-xl border-2 border-white">You</div>
                    <div>
                        <!-- ID INI HARUS ADA SUPAYA BISA DIUPDATE JS -->
                        <h3 class="font-bold text-white" id="rank-username">Agent</h3>
                        <p class="text-xs text-cyber-gold" id="rank-balance">0 Credits</p>
                    </div>
                </div>
                <div class="text-right"><p class="text-[10px] text-gray-400">LEAGUE</p><p class="font-bold text-cyber-blue">ELITE</p></div>
            </div>

            <!-- FAKE TOP PLAYERS -->
            <div class="space-y-3 overflow-y-auto pb-4 h-[55vh]" id="leaderboard-list">
                 <!-- Generated by JS -->
            </div>
        </div>
    </div>

    <!-- NAV BAR -->
    <div class="fixed bottom-6 left-6 right-6 z-50">
        <div class="nav-glass glass-card rounded-full p-2 flex justify-around items-center">
            <button onclick="switchTab('home')" class="nav-btn text-cyber-blue flex flex-col items-center w-1/4" data-target="home"><i class="fa-solid fa-microchip text-xl mb-1"></i><span class="text-[9px] font-bold">CORE</span></button>
            <button onclick="switchTab('mine')" class="nav-btn text-gray-500 flex flex-col items-center w-1/4" data-target="mine"><i class="fa-solid fa-rocket text-xl mb-1"></i><span class="text-[9px] font-bold">BOOST</span></button>
            <button onclick="switchTab('earn')" class="nav-btn text-gray-500 flex flex-col items-center w-1/4" data-target="earn"><i class="fa-solid fa-gift text-xl mb-1"></i><span class="text-[9px] font-bold">EARN</span></button>
            <button onclick="switchTab('rank')" class="nav-btn text-gray-500 flex flex-col items-center w-1/4" data-target="rank"><i class="fa-solid fa-trophy text-xl mb-1"></i><span class="text-[9px] font-bold">RANK</span></button>
        </div>
    </div>
    
    <div id="toast" class="fixed top-24 left-1/2 transform -translate-x-1/2 glass-card px-6 py-3 rounded-full border-cyber-blue/50 opacity-0 pointer-events-none z-[100] flex items-center gap-3 transition-all duration-300"><i class="fa-solid fa-circle-check text-cyber-blue"></i><span id="toast-msg" class="text-sm font-bold">Success</span></div>

    <script>
        const tg = window.Telegram.WebApp; tg.ready(); tg.expand();
        if (tg.setHeaderColor) tg.setHeaderColor('#020205');

        // --- 1. CONFIG MANIFEST (GANTI LINK INI!) ---
        // Ganti dengan link GitHub Pages Bos yang benar
        const MANIFEST_URL = 'https://rstm12.github.io/CyberPanda/tonconnect-manifest.json'; 

        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: MANIFEST_URL,
            buttonRootId: 'ton-connect-btn'
        });

        const STORAGE_KEY = 'cyberPanda_LIVE_PERMANENT';

        const defaultData = { 
            hasStarted: false, balance: 0, energy: 1000, maxEnergy: 1000, clickPower: 1, profitPerSec: 1, lastLogin: Date.now(), 
            upgrades: { multitap: { level: 1, price: 500 }, energy: { level: 1, price: 1000 }, mining_rig: { level: 0, price: 5000 } }, 
            completedTasks: [],
            daily: { lastClaimTime: 0, streak: 0 }
        };
        
        let savedData = JSON.parse(localStorage.getItem(STORAGE_KEY));
        let gameData = { ...defaultData, ...savedData };
        if (!gameData.daily) gameData.daily = { lastClaimTime: 0, streak: 0 }; 

        function saveData() { localStorage.setItem(STORAGE_KEY, JSON.stringify(gameData)); }

        // --- WALLET & UI LOGIC (FIXED) ---
        const walletIndicator = document.getElementById('wallet-indicator');
        const walletStatusText = document.getElementById('wallet-status-text');

        // Fungsi Update UI Wallet
        function updateWalletUI(wallet) {
            if (wallet) {
                // Konek
                walletIndicator.classList.remove('bg-gray-500'); 
                walletIndicator.classList.add('bg-green-500', 'shadow-[0_0_10px_#00ff00]');
                
                const addr = wallet.account.address;
                const shortAddr = addr.slice(0, 4) + '...' + addr.slice(-4);
                
                // Update text di header
                walletStatusText.innerText = shortAddr;
                walletStatusText.classList.add('text-green-400');
            } else {
                // Disconnect
                walletIndicator.classList.add('bg-gray-500'); 
                walletIndicator.classList.remove('bg-green-500', 'shadow-[0_0_10px_#00ff00]');
                
                walletStatusText.innerText = "No Wallet";
                walletStatusText.classList.remove('text-green-400');
            }
        }

        // Listener Status
        tonConnectUI.onStatusChange(wallet => {
            updateWalletUI(wallet);
        });

        // --- INIT DATA ---
        const welcomeScreen = document.getElementById('welcome-screen');
        const userName = tg.initDataUnsafe?.user?.first_name || "Agent";
        document.getElementById('welcome-name').innerText = userName;
        document.getElementById('username').innerText = userName;
        document.getElementById('rank-username').innerText = userName; // Set Nama di Rank

        if (gameData.hasStarted) { welcomeScreen.style.display = 'none'; }
        window.startGame = () => { welcomeScreen.classList.add('hidden-screen'); gameData.hasStarted = true; saveData(); setTimeout(() => welcomeScreen.style.display = 'none', 600); };

        const now = Date.now();
        if (gameData.hasStarted && (now - gameData.lastLogin) > 0) gameData.balance += Math.floor((now - gameData.lastLogin)/1000) * gameData.profitPerSec;
        gameData.lastLogin = now;

        const balanceEl = document.getElementById('balance'); 
        const energyDisplay = document.getElementById('energy-display'); 
        const energyBar = document.getElementById('energy-bar'); 
        const profitEl = document.getElementById('profit-per-sec');
        
        function updateUI() {
            balanceEl.innerText = Math.floor(gameData.balance).toLocaleString(); 
            energyDisplay.innerText = `${Math.floor(gameData.energy)} / ${gameData.maxEnergy}`; 
            energyBar.style.width = `${(gameData.energy / gameData.maxEnergy) * 100}%`; 
            profitEl.innerText = `+${gameData.profitPerSec}`;
            
            document.getElementById('price-multitap').innerText = gameData.upgrades.multitap.price.toLocaleString();
            document.getElementById('price-energy').innerText = gameData.upgrades.energy.price.toLocaleString();
            const rig = gameData.upgrades.mining_rig;
            document.getElementById('price-mining_rig').parentNode.parentNode.innerHTML = rig.level > 0 ? '<span class="text-cyber-blue font-bold">ACTIVE</span>' : `<div class="text-cyber-gold font-bold"><i class="fa-solid fa-coins"></i> <span id="price-mining_rig">${rig.price}</span></div>`;

            // UPDATE RANK CARD (SUPAYA GAK HILANG)
            document.getElementById('rank-balance').innerText = Math.floor(gameData.balance).toLocaleString() + " Credits";
        }

        setInterval(() => { if (gameData.hasStarted) { gameData.balance += gameData.profitPerSec; if (gameData.energy < gameData.maxEnergy) gameData.energy += 2; if (gameData.energy > gameData.maxEnergy) gameData.energy = gameData.maxEnergy; gameData.lastLogin = Date.now(); saveData(); updateUI(); } }, 1000);

        document.getElementById('click-btn').addEventListener('pointerdown', (e) => {
            if (gameData.energy >= gameData.clickPower) { gameData.balance += gameData.clickPower; gameData.energy -= gameData.clickPower; if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('heavy'); updateUI(); const el = document.createElement('div'); el.className = 'floating-text'; el.innerText = `+${gameData.clickPower}`; el.style.left = `${e.clientX}px`; el.style.top = `${e.clientY - 80}px`; document.body.appendChild(el); setTimeout(() => el.remove(), 800); } else if(tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
        });

        window.buyUpgrade = (type) => { const up = gameData.upgrades[type]; if (type === 'mining_rig' && up.level > 0) return showToast('Already Active!', 'error'); if (gameData.balance >= up.price) { gameData.balance -= up.price; if (type === 'mining_rig') { up.level = 1; gameData.profitPerSec = 50; showToast('Rig Activated!');} else { up.level++; up.price = Math.floor(up.price * 1.6); if(type=='multitap') gameData.clickPower++; if(type=='energy') gameData.maxEnergy+=500; showToast('Upgraded!');} updateUI(); saveData(); } else showToast('Need Credits!', 'error'); };

        // DAILY
        const dailyRewards = [500, 1000, 2500, 5000, 10000, 25000, 100000];
        document.getElementById('daily-claim-btn').addEventListener('click', function() { claimDaily(); });

        function renderDailyLogin() {
            const container = document.getElementById('daily-container');
            const streakDisplay = document.getElementById('daily-streak-display');
            const claimBtn = document.getElementById('daily-claim-btn');
            container.innerHTML = '';
            
            const lastClaimDate = new Date(gameData.daily.lastClaimTime); lastClaimDate.setHours(0,0,0,0);
            const today = new Date(); today.setHours(0,0,0,0);
            const isClaimable = lastClaimDate.getTime() < today.getTime();
            
            const diffTime = Math.abs(today - lastClaimDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            if (diffDays > 1 && gameData.daily.lastClaimTime !== 0) { if(isClaimable) gameData.daily.streak = 0; }

            streakDisplay.innerText = `Day ${gameData.daily.streak + 1}`;
            for (let i = 0; i < 7; i++) {
                let statusClass = 'bg-gray-800 border-gray-700 opacity-50';
                if (i < gameData.daily.streak) statusClass = 'bg-green-900/50 border-green-500 opacity-100';
                else if (i === gameData.daily.streak) statusClass = 'bg-cyber-blue/20 border-cyber-blue animate-pulse-glow';
                const dayDiv = document.createElement('div'); dayDiv.className = `min-w-[70px] h-[90px] rounded-xl border flex flex-col items-center justify-center p-2 ${statusClass}`; dayDiv.innerHTML = `<span class="text-[10px] text-gray-400">Day ${i+1}</span><i class="fa-solid fa-gift text-xl my-1 ${i===gameData.daily.streak?'text-cyber-gold':'text-gray-500'}"></i><span class="text-[10px] font-bold text-white">${dailyRewards[i].toLocaleString()}</span>`; container.appendChild(dayDiv);
            }
            if (isClaimable) { claimBtn.disabled = false; claimBtn.innerText = "CLAIM REWARD"; claimBtn.classList.remove('opacity-50', 'cursor-not-allowed'); } 
            else { claimBtn.disabled = true; claimBtn.innerText = "COME BACK TOMORROW"; claimBtn.classList.add('opacity-50', 'cursor-not-allowed'); }
        }

        function claimDaily() {
            const lastClaimDate = new Date(gameData.daily.lastClaimTime); lastClaimDate.setHours(0,0,0,0);
            const today = new Date(); today.setHours(0,0,0,0);
            if (lastClaimDate.getTime() >= today.getTime()) { showToast("Already claimed today!", "error"); return; }
            const reward = dailyRewards[gameData.daily.streak];
            gameData.balance += reward;
            gameData.daily.streak = (gameData.daily.streak + 1); if(gameData.daily.streak >= 7) gameData.daily.streak = 0;
            gameData.daily.lastClaimTime = Date.now();
            saveData(); updateUI(); renderDailyLogin(); showToast(`Received +${reward.toLocaleString()}!`);
            if(tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
        }

        // LEADERBOARD LIST
        function renderLeaderboard() {
            const list = document.getElementById('leaderboard-list'); list.innerHTML = '';
            const names = ["CryptoWhale_01", "TonMaster_GEM", "PandaKing", "Satoshi_Fan", "PixelPanda", "Future_X", "Red_Baron"];
            const scores = [99500000, 88200000, 76000000, 50000000, 42000000, 30000000, 15000000];
            names.forEach((name, i) => {
                 list.innerHTML += `<div class="glass-card p-3 rounded-xl flex items-center justify-between opacity-80"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-gray-800 text-gray-400 flex items-center justify-center font-bold text-xs">${i + 1}</div><span class="font-bold text-gray-200 text-sm">${name}</span></div><span class="text-cyber-gold font-bold text-sm">${scores[i].toLocaleString()}</span></div>`;
            });
        }

        const tasks = [{ id: 'tg_channel_ofc', title: 'Join Official Channel', reward: 5000, icon: 'fa-telegram', url: 'https://t.me/CyberpandaOFC' }, { id: 'youtube', title: 'Subscribe YouTube', reward: 2000, icon: 'fa-youtube', url: 'https://youtube.com' }];
        function renderTasks() { const list = document.getElementById('task-list'); list.innerHTML = ''; tasks.forEach(task => { const isDone = gameData.completedTasks.includes(task.id); const item = document.createElement('div'); item.className = `glass-card p-4 rounded-2xl flex items-center justify-between ${isDone ? 'opacity-50' : 'cursor-pointer'}`; if(!isDone) item.onclick = () => { tg.openLink(task.url); showToast("Verifying...", "info"); setTimeout(() => { gameData.balance += task.reward; gameData.completedTasks.push(task.id); renderTasks(); updateUI(); saveData(); showToast("Credits Added!"); }, 3000); }; item.innerHTML = `<div class="flex items-center gap-3"><i class="fa-brands ${task.icon} text-2xl text-cyber-blue"></i><div><h3 class="font-bold text-sm">${task.title}</h3><div class="text-cyber-gold text-xs font-bold">+${task.reward}</div></div></div>${isDone ? '<i class="fa-solid fa-check text-cyber-blue"></i>' : '<div class="bg-cyber-blue/20 text-cyber-blue px-3 py-1 rounded text-[10px] font-bold">GO</div>'}`; list.appendChild(item); }); }

        window.switchTab = (tabId) => { 
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active')); 
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('text-cyber-blue')); 
            document.getElementById(`tab-${tabId}`).classList.add('active'); 
            document.querySelector(`.nav-btn[data-target="${tabId}"]`).classList.add('text-cyber-blue'); 
            if(tabId === 'earn') { renderTasks(); renderDailyLogin(); } 
            if(tabId === 'rank') { renderLeaderboard(); updateUI(); }
        };

        function showToast(msg, type='success') { const t = document.getElementById('toast'); document.getElementById('toast-msg').innerText = msg; t.style.opacity = '1'; t.style.transform = 'translate(-50%, 0)'; setTimeout(() => { t.style.opacity = '0'; t.style.transform = 'translate(-50%, -20px)'; }, 2000); }

        // CHECK WALLET ON LOAD
        // Kita panggil manual juga saat load untuk memastikan status terupdate
        if (tonConnectUI.wallet) {
            updateWalletUI(tonConnectUI.wallet);
        }

        updateUI(); renderTasks(); renderDailyLogin();
    </script>
</body>
</html>
